<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Management Quiz</title>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #ff8a00, #e52e71, #1a2a6c);
        }
        
        h2 {
            text-align: center;
            color: #1a2a6c;
            margin-bottom: 25px;
            font-size: 28px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        h3 {
            color: #1a2a6c;
            margin: 20px 0 15px;
            font-size: 22px;
        }
        
        p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        input[type="text"], 
        input[type="email"], 
        input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #1a2a6c;
            box-shadow: 0 0 8px rgba(26, 42, 108, 0.3);
        }
        
        button {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 15px 0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: block;
            width: 100%;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .quiz-question {
            background: #f9f9ff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #1a2a6c;
        }
        
        .quiz-question p {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 18px;
            color: #1a2a6c;
        }
        
        .option-line {
            display: block;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e0e0e0;
        }
        
        .option-line:hover {
            background: #f0f4ff;
            transform: translateX(5px);
        }
        
        #result {
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
        }
        
        .correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        
        .incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .header-section {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .header-section h2 {
            color: white;
            border: none;
        }
        
        .module-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #1a2a6c;
        }
        
        .module-info h4 {
            color: #1a2a6c;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            width: 0%;
            transition: width 0.5s;
        }
        
        .question-counter {
            text-align: right;
            font-weight: 600;
            color: #1a2a6c;
            margin-top: 10px;
        }
        
        .welcome-back {
            text-align: center;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #1a2a6c;
        }
        
        .welcome-back h3 {
            color: #1a2a6c;
            margin-bottom: 15px;
        }
        
        .formula {
            font-family: 'Courier New', Courier, monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 3px solid #1a2a6c;
            font-size: 16px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h2 {
                font-size: 24px;
            }
            
            h3 {
                font-size: 20px;
            }
            
            .quiz-question p {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <div class="header-section">
            <h2>📊 Financial Management Quiz</h2>
            <p>Sources of Finance & Cost of Capital | Week 2</p>
        </div>
        
        <div class="module-info">
            <h4>Module Topics Covered:</h4>
            <p>Equity vs Debt • Ordinary & Preference Shares • Bonds & Debentures • WACC • CAPM • Dividend Discount Model</p>
        </div>
        
        <div id="welcomeSection">
            <div class="welcome-back">
                <h3>👋 Welcome to the Finance Quiz!</h3>
                <p>Enter your name below to get started with this week's quiz on Sources of Finance and Cost of Capital.</p>
            </div>
            <input type="text" id="introName" placeholder="Enter your full name" required />
            <button onclick="greetUser()">Begin Quiz</button>
        </div>

        <div id="greetingSection" style="display:none;">
            <h3 id="greetingMsg"></h3>
            <p>This quiz covers key concepts from Week 2: Sources of Finance and Cost of Capital.</p>
            <div class="module-info">
                <p>Topics include:</p>
                <ul>
                    <li>Equity vs Debt financing</li>
                    <li>Ordinary and preference shares</li>
                    <li>Cost of capital calculations</li>
                    <li>WACC and its applications</li>
                </ul>
            </div>
            <button onclick="showQuizSection()">Start Quiz Now</button>
        </div>

        <div id="quizSection" style="display:none;">
            <h3>📘 Week 2: Sources of Finance & Cost of Capital</h3>
            <div class="progress-bar">
                <div class="progress" id="quizProgress"></div>
            </div>
            <div class="question-counter" id="questionCounter">Question 1 of 20</div>
            
            <form id="quizForm">
                <div class="quiz-question">
                    <p>1. Which of the following is a key advantage of debt financing over equity financing?</p>
                    <label class="option-line">A. No repayment obligations <input type="radio" name="q1" value="A" required /></label>
                    <label class="option-line">B. Interest payments are tax-deductible <input type="radio" name="q1" value="B" /></label>
                    <label class="option-line">C. No impact on ownership control <input type="radio" name="q1" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>2. What is the main difference between ordinary shares and preference shares?</p>
                    <label class="option-line">A. Ordinary shares pay fixed dividends <input type="radio" name="q2" value="A" required /></label>
                    <label class="option-line">B. Preference shareholders have priority in dividend payments <input type="radio" name="q2" value="B" /></label>
                    <label class="option-line">C. Ordinary shares are always redeemable <input type="radio" name="q2" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>3. In the context of cost of capital, what does WACC stand for?</p>
                    <label class="option-line">A. Weighted Average Cost of Capital <input type="radio" name="q3" value="A" required /></label>
                    <label class="option-line">B. Weighted Average Capital Cost <input type="radio" name="q3" value="B" /></label>
                    <label class="option-line">C. Working Asset Capital Calculation <input type="radio" name="q3" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>4. Which source of finance is typically the most expensive for a company?</p>
                    <label class="option-line">A. Bank overdraft <input type="radio" name="q4" value="A" required /></label>
                    <label class="option-line">B. Ordinary share capital <input type="radio" name="q4" value="B" /></label>
                    <label class="option-line">C. Debentures <input type="radio" name="q4" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>5. What is a key benefit of listing shares on a stock exchange?</p>
                    <label class="option-line">A. Guaranteed dividend payments <input type="radio" name="q5" value="A" required /></label>
                    <label class="option-line">B. Enhanced ability to raise new capital <input type="radio" name="q5" value="B" /></label>
                    <label class="option-line">C. Reduced regulatory requirements <input type="radio" name="q5" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>6. In the CAPM formula, what does β (beta) represent?</p>
                    <label class="option-line">A. The risk-free rate of return <input type="radio" name="q6" value="A" required /></label>
                    <label class="option-line">B. The market risk premium <input type="radio" name="q6" value="B" /></label>
                    <label class="option-line">C. The systematic risk of the security <input type="radio" name="q6" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>7. Which of the following is considered a short-term source of finance?</p>
                    <label class="option-line">A. Mortgage bonds <input type="radio" name="q7" value="A" required /></label>
                    <label class="option-line">B. Trade creditors <input type="radio" name="q7" value="B" /></label>
                    <label class="option-line">C. Preference shares <input type="radio" name="q7" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>8. What is the primary reason that debt financing is generally cheaper than equity financing?</p>
                    <label class="option-line">A. Debt has no maturity date <input type="radio" name="q8" value="A" required /></label>
                    <label class="option-line">B. Interest payments are tax-deductible <input type="radio" name="q8" value="B" /></label>
                    <label class="option-line">C. Debt holders have voting rights <input type="radio" name="q8" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>9. Which formula represents the Dividend Discount Model?</p>
                    <div class="formula">k<sub>e</sub> = [D<sub>0</sub>(1 + g)/P<sub>0</sub>] + g</div>
                    <label class="option-line">A. Cost of debt formula <input type="radio" name="q9" value="A" required /></label>
                    <label class="option-line">B. Cost of preference shares formula <input type="radio" name="q9" value="B" /></label>
                    <label class="option-line">C. Cost of ordinary shares formula <input type="radio" name="q9" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>10. What is a key difference between debentures and ordinary shares?</p>
                    <label class="option-line">A. Debentures represent ownership in the company <input type="radio" name="q10" value="A" required /></label>
                    <label class="option-line">B. Debenture holders are creditors, not owners <input type="radio" name="q10" value="B" /></label>
                    <label class="option-line">C. Ordinary shares have fixed dividend payments <input type="radio" name="q10" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>11. In WACC calculations, why do we use after-tax cost of debt?</p>
                    <label class="option-line">A. Because dividends are tax-deductible <input type="radio" name="q11" value="A" required /></label>
                    <label class="option-line">B. Because interest payments are tax-deductible <input type="radio" name="q11" value="B" /></label>
                    <label class="option-line">C. Because share issues reduce tax liability <input type="radio" name="q11" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>12. What is the primary purpose of calculating WACC?</p>
                    <label class="option-line">A. To determine dividend payout ratios <input type="radio" name="q12" value="A" required /></label>
                    <label class="option-line">B. To evaluate potential investment projects <input type="radio" name="q12" value="B" /></label>
                    <label class="option-line">C. To calculate employee compensation <input type="radio" name="q12" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>13. Which of the following is a characteristic of preference shares?</p>
                    <label class="option-line">A. They always carry voting rights <input type="radio" name="q13" value="A" required /></label>
                    <label class="option-line">B. They have priority over ordinary shares for dividends <input type="radio" name="q13" value="B" /></label>
                    <label class="option-line">C. Their dividends are tax-deductible <input type="radio" name="q13" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>14. What is the main advantage of trade credit as a short-term financing option?</p>
                    <label class="option-line">A. It typically has no interest cost <input type="radio" name="q14" value="A" required /></label>
                    <label class="option-line">B. It improves the company's credit rating <input type="radio" name="q14" value="B" /></label>
                    <label class="option-line">C. It doesn't affect working capital <input type="radio" name="q14" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>15. What does the CAPM formula calculate?</p>
                    <div class="formula">k<sub>e</sub> = r<sub>f</sub> + β(r<sub>m</sub> - r<sub>f</sub>)</div>
                    <label class="option-line">A. Cost of debt <input type="radio" name="q15" value="A" required /></label>
                    <label class="option-line">B. Cost of ordinary shares <input type="radio" name="q15" value="B" /></label>
                    <label class="option-line">C. Cost of preference shares <input type="radio" name="q15" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>16. Why might a company choose sale and leaseback as a financing option?</p>
                    <label class="option-line">A. To remove assets from the balance sheet <input type="radio" name="q16" value="A" required /></label>
                    <label class="option-line">B. To raise capital while retaining asset use <input type="radio" name="q16" value="B" /></label>
                    <label class="option-line">C. To reduce dividend payments <input type="radio" name="q16" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>17. What is a key consideration in determining a company's optimal capital structure?</p>
                    <label class="option-line">A. Maximizing the use of expensive equity financing <input type="radio" name="q17" value="A" required /></label>
                    <label class="option-line">B. Balancing tax benefits of debt with financial risk <input type="radio" name="q17" value="B" /></label>
                    <label class="option-line">C. Minimizing the use of all external financing <input type="radio" name="q17" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>18. How should a company use WACC in investment decisions?</p>
                    <label class="option-line">A. As the maximum acceptable return rate <input type="radio" name="q18" value="A" required /></label>
                    <label class="option-line">B. As the minimum acceptable return rate <input type="radio" name="q18" value="B" /></label>
                    <label class="option-line">C. As a secondary consideration after payback period <input type="radio" name="q18" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>19. What is a characteristic of cumulative preference shares?</p>
                    <label class="option-line">A. Dividends accumulate if not paid when due <input type="radio" name="q19" value="A" required /></label>
                    <label class="option-line">B. They convert to ordinary shares automatically <input type="radio" name="q19" value="B" /></label>
                    <label class="option-line">C. They have variable dividend rates <input type="radio" name="q19" value="C" /></label>
                </div>

                <div class="quiz-question">
                    <p>20. Why is the cost of retained earnings considered similar to the cost of ordinary shares?</p>
                    <label class="option-line">A. Because both are tax-deductible <input type="radio" name="q20" value="A" required /></label>
                    <label class="option-line">B. Because both represent equity financing <input type="radio" name="q20" value="B" /></label>
                    <label class="option-line">C. Because both have fixed return rates <input type="radio" name="q20" value="C" /></label>
                </div>
                
                <button type="button" onclick="submitQuiz()">Submit Quiz</button>
            </form>
            <p id="result"></p>
        </div>

        <div id="thankYou" style="display:none;">
            <h3>🎉 Thank you for completing the quiz!</h3>
            <p id="finalScore"></p>
            <p>Review the module materials to strengthen your understanding of any challenging concepts.</p>
            <button onclick="location.reload()">Take Again</button>
        </div>

        <div id="loginSection" style="display:none;">
            <h3>👨‍🏫 Tutor Login</h3>
            <input type="email" id="email" placeholder="Tutor Email" required />
            <input type="password" id="password" placeholder="Password" required />
            <label>
                <input type="checkbox" onclick="togglePassword()" /> Show Password
            </label>
            <button onclick="loginTutor()">Login as Tutor</button>
        </div>

        <div id="adminPanel" style="display:none;">
            <h3>👨‍🏫 Student Results</h3>
            <div id="studentList"></div>
            <button onclick="location.reload()">Back to Quiz</button>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBM0etPzV4XkPfBcLBUjQ5G3JZB428qyF8",
            authDomain: "financeisfun-78594.firebaseapp.com",
            projectId: "financeisfun-78594",
            storageBucket: "financeisfun-78594.appspot.com",
            messagingSenderId: "249768918465",
            appId: "1:249768918465:web:5b9048caf1059848bfc340"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Store correct answers
        const correctAnswers = {
            q1: 'B',
            q2: 'B',
            q3: 'A',
            q4: 'B',
            q5: 'B',
            q6: 'C',
            q7: 'B',
            q8: 'B',
            q9: 'C',
            q10: 'B',
            q11: 'B',
            q12: 'B',
            q13: 'B',
            q14: 'A',
            q15: 'B',
            q16: 'B',
            q17: 'B',
            q18: 'B',
            q19: 'A',
            q20: 'B'
        };
        
        let userName = '';
        
        function greetUser() {
            const nameInput = document.getElementById('introName');
            if (nameInput.value.trim() === '') {
                alert('Please enter your name to continue.');
                return;
            }
            
            userName = nameInput.value.trim();
            document.getElementById('greetingMsg').textContent = `Welcome back, ${userName}! Ready for this week's quiz?`;
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('greetingSection').style.display = 'block';
        }
        
        function showQuizSection() {
            document.getElementById('greetingSection').style.display = 'none';
            document.getElementById('quizSection').style.display = 'block';
            updateProgressBar();
        }
        
        function updateProgressBar() {
            const answered = document.querySelectorAll('input[type="radio"]:checked').length;
            const progress = (answered / 20) * 100;
            document.getElementById('quizProgress').style.width = `${progress}%`;
            document.getElementById('questionCounter').textContent = `Question ${answered+1} of 20`;
        }
        
        // Add event listeners to radio buttons to update progress
        const radioButtons = document.querySelectorAll('input[type="radio"]');
        radioButtons.forEach(radio => {
            radio.addEventListener('change', updateProgressBar);
        });
        
        function submitQuiz() {
            let score = 0;
            const form = document.getElementById('quizForm');
            
            // Check if all questions are answered
            let allAnswered = true;
            for (let i = 1; i <= 20; i++) {
                const questionName = `q${i}`;
                if (!document.querySelector(`input[name="${questionName}"]:checked`)) {
                    allAnswered = false;
                    break;
                }
            }
            
            if (!allAnswered) {
                alert('Please answer all questions before submitting.');
                return;
            }
            
            // Calculate score
            for (let i = 1; i <= 20; i++) {
                const questionName = `q${i}`;
                const selected = document.querySelector(`input[name="${questionName}"]:checked`).value;
                
                if (selected === correctAnswers[questionName]) {
                    score++;
                    // Highlight correct answer
                    const correctOption = document.querySelector(`input[name="${questionName}"][value="${correctAnswers[questionName]}"]`).parentElement;
                    correctOption.classList.add('correct');
                } else {
                    // Highlight correct answer and incorrect selection
                    const selectedOption = document.querySelector(`input[name="${questionName}"]:checked`).parentElement;
                    selectedOption.classList.add('incorrect');
                    
                    const correctOption = document.querySelector(`input[name="${questionName}"][value="${correctAnswers[questionName]}"]`).parentElement;
                    correctOption.classList.add('correct');
                }
            }
            
            // Show results
            const percentage = Math.round((score / 20) * 100);
            let message = '';
            
            if (percentage >= 80) {
                message = `🎉 Excellent work, ${userName}! You scored ${score}/20 (${percentage}%)`;
            } else if (percentage >= 60) {
                message = `👍 Good job, ${userName}! You scored ${score}/20 (${percentage}%)`;
            } else {
                message = `📚 Keep studying, ${userName}. You scored ${score}/20 (${percentage}%)`;
            }
            
            document.getElementById('result').textContent = message;
            document.getElementById('result').className = percentage >= 60 ? 'correct' : 'incorrect';
            
            // Scroll to results
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            
            // Disable form after submission
            const inputs = form.querySelectorAll('input');
            inputs.forEach(input => {
                input.disabled = true;
            });
            
            // Save student data
            const studentData = {
                name: userName,
                score: score,
                percentage: percentage,
                timestamp: new Date()
            };
            
            db.collection("students").add(studentData)
                .then(() => {
                    // Change submit button to show thank you
                    const submitBtn = form.querySelector('button');
                    submitBtn.textContent = 'View Results';
                    submitBtn.onclick = function() {
                        document.getElementById('quizSection').style.display = 'none';
                        document.getElementById('thankYou').style.display = 'block';
                        document.getElementById('finalScore').textContent = `Final Score: ${score}/20 (${percentage}%)`;
                    };
                })
                .catch(error => {
                    console.error("Error saving student data: ", error);
                    alert("There was an error saving your results. Please try again.");
                });
        }
        
        function togglePassword() {
            const pw = document.getElementById("password");
            pw.type = pw.type === "password" ? "text" : "password";
        }
        
        function loginTutor() {
            const email = document.getElementById("email").value;
            const pass = document.getElementById("password").value;

            if (!email || !pass) {
                alert("Please enter both email and password.");
                return;
            }

            auth.signInWithEmailAndPassword(email, pass)
                .then(() => {
                    document.getElementById('loginSection').style.display = 'none';
                    showAdminPanel();
                })
                .catch(err => alert("Login failed: " + err.message));
        }
        
        function showAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
            const list = document.getElementById('studentList');
            list.innerHTML = '';

            db.collection("students").orderBy("timestamp", "desc").get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        list.innerHTML = '<p>No student submissions yet.</p>';
                        return;
                    }

                    snapshot.forEach(doc => {
                        const s = doc.data();
                        const card = document.createElement('div');
                        card.className = 'student-card';
                        card.innerHTML = `
                            <strong>${s.name}</strong>
                            <p>📅 Submitted: ${s.timestamp.toDate().toLocaleString()}</p>
                            <p>✅ Quiz Score: ${s.score}/20 (${s.percentage}%)</p>
                        `;
                        list.appendChild(card);
                    });
                })
                .catch(error => {
                    console.error("Error getting student data: ", error);
                    list.innerHTML = '<p>Error loading student data. Please try again later.</p>';
                });
        }
        
        // Check if user is tutor
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('welcomeSection').style.display = 'none';
                document.getElementById('greetingSection').style.display = 'none';
                document.getElementById('quizSection').style.display = 'none';
                document.getElementById('thankYou').style.display = 'none';
                document.getElementById('loginSection').style.display = 'none';
                showAdminPanel();
            } else {
                // Show login section only if not a student taking the quiz
                if (!userName) {
                    document.getElementById('loginSection').style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>
